{"pageProps":{"markdoc":{"content":[{"$$mdtype":"Tag","name":"h2","attributes":{"id":"features"},"children":["Features"]},{"$$mdtype":"Tag","name":"SpecTable","attributes":{},"children":[{"$$mdtype":"Tag","name":"SpecTableRow","attributes":{"title":"Complexity","description":"Low"},"children":[]},{"$$mdtype":"Tag","name":"SpecTableRow","attributes":{"title":"Authentication","description":"✅"},"children":[]},{"$$mdtype":"Tag","name":"SpecTableRow","attributes":{"title":"Confidentiality","description":"❌"},"children":[]},{"$$mdtype":"Tag","name":"SpecTableRow","attributes":{"title":"Integrity","description":"✅"},"children":[]},{"$$mdtype":"Tag","name":"SpecTableRow","attributes":{"title":"Non-Repudiation","description":"❌"},"children":[]},{"$$mdtype":"Tag","name":"SpecTableRow","attributes":{"title":"Replay Prevention","description":"Requires Timestamps","link":"/docs/hmac/replay-prevention"},"children":[]},{"$$mdtype":"Tag","name":"SpecTableRow","attributes":{"title":"Versioning","description":"Requires Forward Compatibility","link":"/docs/hmac/versioning"},"children":[]},{"$$mdtype":"Tag","name":"SpecTableRow","attributes":{"title":"Zero Downtime Rotation","description":"Requires Key Rotation","link":"/docs/hmac/key-rotation"},"children":[]}]},{"$$mdtype":"Tag","name":"h2","attributes":{"id":"overview"},"children":["Overview"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["HMAC is, by far, the most popular authentication and message security method used on webhook requests. In this method, the webhook provider and listener use a secret key to sign and validate webhook requests."]},{"$$mdtype":"Tag","name":"ol","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":["On webhook requests, the provider signs the webhook message using the secret key plus a hashing algorithm — typically HMAC-SHA256, encodes the resulting signature in base64 or hex, and finally includes the encoded signature in the webhook request as a header."]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":["The webhook listener receives the request and repeats the same steps from the webhook provider — signs and encodes the webhook message using the secret key — and compares the resulting signature with the value sent on the request header. If the result matches, the request is considered legit."]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"language":"mermaid"},"children":["sequenceDiagram\n  Note left of Webhook Service: Create webhook message\n  Note left of Webhook Service: Generate signature hash of the message body with the shared secret\n  Webhook Service->>+Listening App: Send Webhook notification\n  Note right of Listening App: Generate signature hash of the message body with the shared secret\n  Note right of Listening App: Validate signature hash vs the value sent by the webhook service\n  Note right of Listening App: Process webhook call\n  Listening App-->>-Webhook Service: Return response.\n"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"em","attributes":{},"children":["Request Signature Validation"]}]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["HMAC offers the following advantages versus Basic Authentication:"]},{"$$mdtype":"Tag","name":"ol","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["Authentication + message integrity"]},": Assuming the secret key is known only by the webhook provider and the listener, the HMAC process verifies that the message comes from the webhook provider (authenticity) and its contents are the same as they were at the time of sending (integrity)."]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["The secret key remains secret:"]}," In HMAC, secret keys are not sent with the webhook request — only the signatures created with it — reducing the risk of stolen keys."]}]},{"$$mdtype":"Tag","name":"h4","attributes":{},"children":["HMAC is only as good as its implementation"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Like any other security control, HMAC is only as good as its implementation. In our research, we saw many examples of webhook providers with unnecessary complexity, lousy security, and lack of documentation that made their solutions tough to implement, manage, and keep safe. While we share more of what we saw in our ",{"$$mdtype":"Tag","name":"a","attributes":{"href":"https://blog.ngrok.com"},"children":["article"]},", these are four of the most frustrating cases:"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["Unnecessary complexity"]},": Many webhook providers have signature steps with unnecessary steps. One webhook provider adds line breaks within the webhook signature. This step only adds complexity — esp on systems using different characters to break lines — without adding any security value:"]},{"$$mdtype":"Tag","name":"Fence","attributes":{},"children":["1. Take the method for the request + \"\\n\" \\\n2. Take the URL path of the request + \"\\n\" \\\n3. Take the list of signed headers comma-delimited from a specific header.  \\\n3.1 For each header, append the header name (in lower case) + \":\" + the header value. \\\n3.2 After all headers are collected, concatenate them separated by semicolon \";\" \\\n3.3 End the list of headers with + \"\\n\" \\\n4. Add the request body \\\n5. Hash the string above using the secret key \\\n6. Base64 encode the resulting hash\n"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["Use of privileged credentials as secrets"]},": One of the SHA 1 implementations we implemented used an Auth Token — instead of a randomly generated secret with zero API privileges — as the key to sign webhook requests. Because this auth token could be used — alongside an account id — to make REST API requests, it introduces additional risk and makes the webhook unnecessarily riskier to distribute."]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["Bad Documentation"]},": Some providers skip steps, deliver incomplete code snippets, and assume people's familiarity with their webhook security implementation. Approx. 10% of the webhook providers we implemented missed critical information on how to generate their webhook signatures. One of the implementations documented their entire webhook security in one paragraph, missing key information such as the encoding format used in their signature. To overcome the bad docs, we spent extra calories guess working, scraping the internet, and unit testing webhooks until finding something that made sense."]},{"$$mdtype":"Tag","name":"h2","attributes":{"id":"examples"},"children":["Examples"]},{"$$mdtype":"Tag","name":"SpecTable","attributes":{},"children":[{"$$mdtype":"Tag","name":"SpecTableRow","attributes":{"title":"Box","description":"Docs","link":"https://developer.box.com/guides/webhooks/v2/signatures-v2/"},"children":[]},{"$$mdtype":"Tag","name":"SpecTableRow","attributes":{"title":"CircleCI","description":"Docs","link":"https://circleci.com/docs/2.0/webhooks/"},"children":[]},{"$$mdtype":"Tag","name":"SpecTableRow","attributes":{"title":"GitHub","description":"Docs","link":"https://docs.github.com/en/developers/webhooks-and-events/webhooks/securing-your-webhooks"},"children":[]}]}],"frontmatter":{"title":"HMAC","description":"Hash-based Message Authentication Code (HMAC)"},"file":{"path":"/docs/hmac.md"}}},"__N_SSG":true}