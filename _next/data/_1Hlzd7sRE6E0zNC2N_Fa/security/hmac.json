{"pageProps":{"markdoc":{"content":[{"$$mdtype":"Tag","name":"table","attributes":{},"children":[{"$$mdtype":"Tag","name":"thead","attributes":{},"children":[]},{"$$mdtype":"Tag","name":"tbody","attributes":{},"children":[{"$$mdtype":"Tag","name":"tr","attributes":{},"children":[{"$$mdtype":"Tag","name":"td","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["Complexity"]}]},{"$$mdtype":"Tag","name":"td","attributes":{},"children":[{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":["Low"]}]}]}]},{"$$mdtype":"Tag","name":"tr","attributes":{},"children":[{"$$mdtype":"Tag","name":"td","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["Pros"]}]},{"$$mdtype":"Tag","name":"td","attributes":{},"children":[{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":["Authentication and Message Integrity with Low Complexity"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":["Secret keys are not sent in the webhook notification"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":["Hash signature enables timestamp validation"]}]}]}]},{"$$mdtype":"Tag","name":"tr","attributes":{},"children":[{"$$mdtype":"Tag","name":"td","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["Caveats"]}]},{"$$mdtype":"Tag","name":"td","attributes":{},"children":[{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":["No confidentiality controls"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":["Introduces additional complexity with complex signature payloads"]}]}]}]},{"$$mdtype":"Tag","name":"tr","attributes":{},"children":[{"$$mdtype":"Tag","name":"td","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["Examples"]}]},{"$$mdtype":"Tag","name":"td","attributes":{},"children":[{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"a","attributes":{"href":"https://developer.box.com/guides/webhooks/v2/signatures-v2/"},"children":["Box"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"a","attributes":{"href":"https://circleci.com/docs/2.0/webhooks/"},"children":["CircleCI"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"a","attributes":{"href":"https://docs.github.com/en/developers/webhooks-and-events/webhooks/securing-your-webhooks"},"children":["GitHub"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"a","attributes":{"href":"https://developers.hubspot.com/docs/api/webhooks/validating-requests"},"children":["Hubspot"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"a","attributes":{"href":"https://developers.intercom.com/intercom-api-reference/v1.0/reference/signed-notifications"},"children":["Intercom"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"a","attributes":{"href":"https://www.mongodb.com/docs/realm/endpoints/#payload-signature-verification"},"children":["MongoDB"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"a","attributes":{"href":"https://developer.pagerduty.com/docs/ZG9jOjExMDI5NTkz-verifying-signatures"},"children":["PagerDuty"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"a","attributes":{"href":"https://shopify.dev/apps/webhooks/configuration/https#step-5-verify-the-webhook"},"children":["Shopify"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"a","attributes":{"href":"https://api.slack.com/authentication/verifying-requests-from-slack"},"children":["Slack"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"a","attributes":{"href":"https://developer.squareup.com/docs/webhooks/step3validate"},"children":["Square"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"a","attributes":{"href":"https://www.twilio.com/docs/usage/security#validating-requests"},"children":["Twilio"]}]}]}]}]}]}]},{"$$mdtype":"Tag","name":"hr","attributes":{},"children":[]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["HMAC is, by far, the most popular authentication and message security method used on webhook requests including 65% of the 100 webhooks we studied. In this method, the webhook provider and listener use a secret key to sign and validate webhook requests."]},{"$$mdtype":"Tag","name":"ol","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":["On webhook requests, the provider signs the webhook message using the secret key plus a hashing algorithm — typically HMAC-SHA256 — encodes the resulting signature in base64 or hex, and includes the encoded signature in the webhook request as a header."]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":["The webhook listener receives the request and repeats the same steps — signs and encodes the webhook message using the secret key — and compares the resulting signature with the value sent in the request header. If the result matches, the request is considered legitimate."]}]},{"$$mdtype":"Tag","name":"DiagramHmac","attributes":{},"children":[]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"em","attributes":{},"children":["Request Signature Validation"]}]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["HMAC offers the following advantages versus Basic Authentication:"]},{"$$mdtype":"Tag","name":"ol","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["Authentication + message integrity"]},": Assuming the secret key is known only by the webhook provider and the listener, the HMAC process verifies that the message comes from the webhook provider (authenticity) and its contents are the same as they were at the time of sending (integrity)."]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["The secret key remains secret:"]}," In HMAC, secret keys are not sent with the webhook request — only the signatures created with it — reducing the risk of stolen keys."]}]},{"$$mdtype":"Tag","name":"h4","attributes":{},"children":["HMAC is only as good as its implementation"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Like any other security control, HMAC is only as good as its implementation. In our research, we saw many examples of webhook providers with unnecessary complexity, lousy security, and lack of documentation that made their solutions tough to implement, manage, and keep safe. While we share more of what we saw in our ",{"$$mdtype":"Tag","name":"a","attributes":{"href":"https://blog.ngrok.com"},"children":["article"]},", these are four of the most frustrating cases:"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["Unnecessary complexity"]},": Many webhook providers have signature steps with unnecessary steps. One webhook provider adds line breaks within the webhook signature. This step only adds complexity — esp on systems using different characters to break lines — without adding any security value:"]},{"$$mdtype":"Tag","name":"Fence","attributes":{},"children":["1. Take the method for the request + \"\\n\" \\\n2. Take the URL path of the request + \"\\n\" \\\n3. Take the list of signed headers comma-delimited from a specific header.  \\\n3.1 For each header, append the header name (in lower case) + \":\" + the header value. \\\n3.2 After all headers are collected, concatenate them separated by semicolon \";\" \\\n3.3 End the list of headers with + \"\\n\" \\\n4. Add the request body \\\n5. Hash the string above using the secret key \\\n6. Base64 encode the resulting hash\n"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["Use of privileged credentials as secrets"]},": One of the SHA 1 implementations we implemented used an Auth Token — instead of a randomly generated secret with zero API privileges — as the key to sign webhook requests. Because this auth token could be used — alongside an account id — to make REST API requests, it introduces additional risk and makes the webhook unnecessarily riskier to distribute."]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["Bad Documentation"]},": Some providers skip steps, deliver incomplete code snippets, and assume people's familiarity with their webhook security implementation. Approx. 10% of the webhook providers we implemented missed critical information on how to generate their webhook signatures. One of the implementations documented their entire webhook security in one paragraph, missing key information such as the encoding format used in their signature. To overcome the bad docs, we spent extra calories guess working, scraping the internet, and unit testing webhooks until finding something that made sense."]}],"frontmatter":{"title":"HMAC","description":"Hash-based Message Authentication Code (HMAC)"},"file":{"path":"/security/hmac.md"}}},"__N_SSG":true}